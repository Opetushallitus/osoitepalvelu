<div>
    <div class="form" role="form">
        <h2>{{msg.search_title}}</h2>

        <div class="form-row">
            <div class="label-cell">
                <label for="savedSearch">{{msg.saved_searches}}</label>
            </div>
            <div class="field-cell">
                <select ui-select2 id="savedSearch" class="form-control" ng-model="selectedSavedSearch"
                        ng-change="handleSaveSelected()">
                   <option class="placeholder" value=""></option>
                   <option ng-repeat="save in saves" value="{{save.id}}">{{save.name}}</option>
                </select>
            </div>
            <div class="actions">
                <button class="btn" ng-click="showSaveSearchPopup()">
                    <i class="fa fa-cog fa-1x"></i>
                </button>
            </div>
        </div>

        <div class="form-row">
            <div class="label-cell">
                <label for="searchType">{{msg.search_type}}</label>
            </div>
            <div class="field-cell">
                <select ui-select2 id="searchType" class="form-control" ng-model="searchType">
                    <option class="placeholder" value="">{{msg.search_type_placeholder}}</option>
                    <option ng-repeat="opt in searchTypes" value="{{opt.type}}">{{opt.name}}</option>
                </select>
            </div>
        </div>

        <div class="form-row" ng-show="searchType == 'SEND_LETTER'">
            <div class="label-cell">
                {{msg.receiver_fields}}
            </div>
            <div class="field-cell">
                <div class="criterionOptions receiverTypes">
                    <div class="criterionOption" ng-repeat="opt in receiverFields">
                        <input id="receiver_field_{{$index}}" type="checkbox" ng-model="opt.selected" />
                        <label for="receiver_field_{{$index}}">{{opt.name}}</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-row" ng-show="searchType == 'CONTACT'">
            <div class="label-cell">
                {{msg.address_fields}}
            </div>
            <div class="field-cell">
                <div class="criterionOptions addressTypes">
                    <div class="criterionOption" ng-repeat="opt in addressFields">
                        <input id="address_field_{{$index}}" type="checkbox" ng-model="opt.selected" />
                        <label for="address_field_{{$index}}">{{opt.name}}</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-row" ng-show="isShowTargetGroup()">
            <div class="label-cell">
                <label for="targetGroup">{{msg.target_group}}</label>
            </div>
            <div class="field-cell">
                <div ng-repeat="tg in visibleTargetGroups" class="selectedCriterion targetGroups">
                    <table class="criterionTable">
                        <th class="selectedCriterionName">
                            {{tg.name}}
                        </th>
                        <td class="criterionOptions">
                            <div class="criterionOption" ng-repeat="opt in tg.options">
                                <input id="optionChecked_{{$parent.$index}}_{{$index}}" type="checkbox" ng-model="opt.selected" /> <label for="optionChecked_{{$parent.$index}}_{{$index}}">{{opt.name}}</label>
                            </div>
                        </td>
                        <td class="criterionActions">
                            <button class="btn btn-danger" ng-click="removeTargetGroup($index)">
                                <i class="fa fa-ban fa-1x"></i>
                            </button>
                        </td>
                    </table>
                </div>
                <select ui-select2 id="targetGroup" class="form-control"
                        ng-model="selectedTargetGroup"
                        ng-change="handleTargetGroupSelected()"
                        ng-show="(targetGroups | filter:nonSelectedByField(selectedTargetGroupTypes, 'type')).length">
                    <option ng-repeat="tg in targetGroups | filter:nonSelectedByField(selectedTargetGroupTypes, 'type')" value="{{tg.type}}">{{tg.name}}</option>
                </select>
            </div>
        </div>

        <div class="form-row" ng-show="isTermsShown()" ng-animate="'animate'">
            <div class="label-cell">
                {{msg.search_terms}}
            </div>
            <div class="field-cell">
                <div class="term" ng-show="isShowTutkintotoimikuntaTerm()">
                    <select ui-select2 multiple id="tutkintotoimikuntas" class="form-control" ng-model="terms.tutkintotoimikuntas" data-placeholder="{{msg.search_term_tutkintotoimikunta}}">
                        <option ng-repeat="opt in options.tutkintotoimikuntas" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term" ng-show="isShowTutkintotoimikuntaRooliTerm()">
                    <select ui-select2 multiple id="tutkintotoimikuntaRoolis" class="form-control" ng-model="terms.tutkintotoimikuntaRoolis" data-placeholder="{{msg.search_term_tutkintotoimikunta_rooli}}">
                        <option ng-repeat="opt in options.tutkintotoimikuntaRoolis" value="{{opt.type}}">{{opt.name}}</option>
                    </select>
                </div>
                <div class="term-separator" ng-show="isShowTutkintotoimikuntaTerm() || isShowTutkintotoimikuntaRooliTerm()"></div>
                <div class="term" ng-show="isShowKoulutaTerm()">
                    <select ui-select2 multiple id="koulutaRoolis" class="form-control" ng-model="terms.koulutaRoolis" data-placeholder="{{msg.search_term_kouluta_rooli}}">
                        <option ng-repeat="opt in options.koulutaRoolis" value="{{opt.id}}">{{opt.name}}</option>
                    </select>
                </div>
                <div class="term" ng-show="isShowAipalTerm()">
                    <select ui-select2 multiple id="aipalRoolis" class="form-control" ng-model="terms.aipalRoolis" data-placeholder="{{msg.search_term_aipal_rooli}}">
                        <option ng-repeat="opt in options.aipalRoolis" value="{{opt.id}}">{{opt.name}}</option>
                    </select>
                </div>
                <div class="term-separator" ng-show="isShowKoulutaTerm() || isShowAipalTerm()"></div>
                <div class="term term-full-width">
                    <select ui-select2 multiple id="organisaationKielis" class="form-control" ng-model="terms.organisaationKielis" data-placeholder="{{msg.search_term_organisaation_kieli}}">
                        <option ng-repeat="opt in options.organisaationKielis" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term-separator"></div>
                <div class="term term-full-width">
                    <select ui-select2 multiple id="avi" class="form-control" ng-model="terms.avis" data-placeholder="{{msg.search_term_avi}}">
                        <option ng-repeat="opt in options.avis" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term-separator"></div>
                <div class="term">
                    <select ui-select2 multiple id="maakunta" class="form-control" ng-model="terms.maakuntas" data-placeholder="{{msg.search_term_maakunta}}">
                        <option ng-repeat="opt in options.maakuntas" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term">
                    <select ui-select2 multiple data-disable-selectall id="kunta" class="form-control" ng-model="terms.kuntas" data-placeholder="{{msg.search_term_kunta}}">
                        <option ng-repeat="opt in options.kuntas" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term-separator"></div>
                <div class="term">
                    <select ui-select2 multiple id="oppilaitostyyppi" class="form-control" ng-model="terms.oppilaitostyyppis" data-placeholder="{{msg.search_term_oppilaitostyyppi}}">
                        <option ng-repeat="opt in options.oppilaitostyyppis" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term">
                    <select ui-select2 multiple id="omistajatyyppi" class="form-control" ng-model="terms.omistajatyyppis" data-placeholder="{{msg.search_term_omistajatyyppi}}">
                        <option ng-repeat="opt in options.omistajatyyppis" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term-separator"></div>
                <div class="trem term">
                    <select ui-select2 multiple id="vuosiluokka" class="form-control" ng-model="terms.vuosiluokkas" data-placeholder="{{msg.search_term_vuosiluokka}}">
                        <option ng-repeat="opt in options.vuosiluokkas" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="trem term">
                    <select ui-select2 multiple data-disable-selectall id="koultuksenjarjestaja" class="form-control" ng-model="terms.koultuksenjarjestajas" data-placeholder="{{msg.search_term_koultuksenjarjestaja}}">
                        <option ng-repeat="opt in options.koultuksenjarjestajas" value="{{opt.koodiId}}">{{opt.nimi}}</option>
                    </select>
                </div>
                <div class="term-separator"></div>

                <div style="clear:both;">
                    <a ng-click="toggleShowMore()">
                        {{ showExtraTerms ? "" : msg.show_more_terms }}
                    </a>
                </div>
                <div ng-show="showExtraTerms">
                    TODO
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="label-cell"></div>
            <div class="field-cell">
                <div class="form-action" ng-if="isSearchAllowed()">
                    <button class="btn btn-lg btn-primary" ng-click="search()">{{msg.search_action}}</button>
                    <button class="btn btn-lg" ng-click="saveSearch()">{{msg.save_search_action}}</button>
                    <button class="btn btn-lg" ng-click="clear()">{{msg.clear_action}}</button>
                </div>
            </div>
        </div>
    </div>
</div>